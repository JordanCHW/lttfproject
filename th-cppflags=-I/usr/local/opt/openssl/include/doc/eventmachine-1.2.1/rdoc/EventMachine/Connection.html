<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: EventMachine::Connection</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/em/connection_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/em/connection.rb">lib/em/connection.rb</a></li>
          
            <li><a href="../lib/em/pure_ruby_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/em/pure_ruby.rb">lib/em/pure_ruby.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="../Object.html">Object</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-close_connection">#close_connection</a></li>
          
          <li><a href="#method-i-close_connection_after_writing">#close_connection_after_writing</a></li>
          
          <li><a href="#method-i-comm_inactivity_timeout">#comm_inactivity_timeout</a></li>
          
          <li><a href="#method-i-comm_inactivity_timeout-3D">#comm_inactivity_timeout=</a></li>
          
          <li><a href="#method-i-connection_completed">#connection_completed</a></li>
          
          <li><a href="#method-i-detach">#detach</a></li>
          
          <li><a href="#method-i-error-3F">#error?</a></li>
          
          <li><a href="#method-i-get_cipher_bits">#get_cipher_bits</a></li>
          
          <li><a href="#method-i-get_cipher_name">#get_cipher_name</a></li>
          
          <li><a href="#method-i-get_cipher_protocol">#get_cipher_protocol</a></li>
          
          <li><a href="#method-i-get_idle_time">#get_idle_time</a></li>
          
          <li><a href="#method-i-get_outbound_data_size">#get_outbound_data_size</a></li>
          
          <li><a href="#method-i-get_peer_cert">#get_peer_cert</a></li>
          
          <li><a href="#method-i-get_peername">#get_peername</a></li>
          
          <li><a href="#method-i-get_pid">#get_pid</a></li>
          
          <li><a href="#method-i-get_proxied_bytes">#get_proxied_bytes</a></li>
          
          <li><a href="#method-i-get_sni_hostname">#get_sni_hostname</a></li>
          
          <li><a href="#method-i-get_sock_opt">#get_sock_opt</a></li>
          
          <li><a href="#method-i-get_sockname">#get_sockname</a></li>
          
          <li><a href="#method-i-get_status">#get_status</a></li>
          
          <li><a href="#method-i-notify_readable-3D">#notify_readable=</a></li>
          
          <li><a href="#method-i-notify_readable-3F">#notify_readable?</a></li>
          
          <li><a href="#method-i-notify_writable-3D">#notify_writable=</a></li>
          
          <li><a href="#method-i-notify_writable-3F">#notify_writable?</a></li>
          
          <li><a href="#method-i-pause">#pause</a></li>
          
          <li><a href="#method-i-paused-3F">#paused?</a></li>
          
          <li><a href="#method-i-pending_connect_timeout">#pending_connect_timeout</a></li>
          
          <li><a href="#method-i-pending_connect_timeout-3D">#pending_connect_timeout=</a></li>
          
          <li><a href="#method-i-post_init">#post_init</a></li>
          
          <li><a href="#method-i-proxy_completed">#proxy_completed</a></li>
          
          <li><a href="#method-i-proxy_incoming_to">#proxy_incoming_to</a></li>
          
          <li><a href="#method-i-proxy_target_unbound">#proxy_target_unbound</a></li>
          
          <li><a href="#method-i-receive_data">#receive_data</a></li>
          
          <li><a href="#method-i-reconnect">#reconnect</a></li>
          
          <li><a href="#method-i-resume">#resume</a></li>
          
          <li><a href="#method-i-send_data">#send_data</a></li>
          
          <li><a href="#method-i-send_datagram">#send_datagram</a></li>
          
          <li><a href="#method-i-send_file_data">#send_file_data</a></li>
          
          <li><a href="#method-i-set_comm_inactivity_timeout">#set_comm_inactivity_timeout</a></li>
          
          <li><a href="#method-i-set_pending_connect_timeout">#set_pending_connect_timeout</a></li>
          
          <li><a href="#method-i-set_sock_opt">#set_sock_opt</a></li>
          
          <li><a href="#method-i-ssl_handshake_completed">#ssl_handshake_completed</a></li>
          
          <li><a href="#method-i-ssl_verify_peer">#ssl_verify_peer</a></li>
          
          <li><a href="#method-i-start_tls">#start_tls</a></li>
          
          <li><a href="#method-i-stop_proxying">#stop_proxying</a></li>
          
          <li><a href="#method-i-stream_file_data">#stream_file_data</a></li>
          
          <li><a href="#method-i-unbind">#unbind</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../docs/old/ChangeLog.html">ChangeLog</a></li>
        
          <li class="file"><a href="../docs/old/DEFERRABLES.html">DEFERRABLES</a></li>
        
          <li class="file"><a href="../docs/old/EPOLL.html">EPOLL</a></li>
        
          <li class="file"><a href="../docs/old/INSTALL.html">INSTALL</a></li>
        
          <li class="file"><a href="../docs/old/KEYBOARD.html">KEYBOARD</a></li>
        
          <li class="file"><a href="../docs/old/LEGAL.html">LEGAL</a></li>
        
          <li class="file"><a href="../docs/old/LIGHTWEIGHT_CONCURRENCY.html">LIGHTWEIGHT_CONCURRENCY</a></li>
        
          <li class="file"><a href="../docs/old/PURE_RUBY.html">PURE_RUBY</a></li>
        
          <li class="file"><a href="../docs/old/RELEASE_NOTES.html">RELEASE_NOTES</a></li>
        
          <li class="file"><a href="../docs/old/SMTP.html">SMTP</a></li>
        
          <li class="file"><a href="../docs/old/SPAWNED_PROCESSES.html">SPAWNED_PROCESSES</a></li>
        
          <li class="file"><a href="../docs/old/TODO.html">TODO</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../EventMachine.html">EventMachine</a></li>
        
          <li><a href="../EventMachine.html">EventMachine</a></li>
        
          <li><a href="../EventMachine/CertificateCreator.html">EventMachine::CertificateCreator</a></li>
        
          <li><a href="../EventMachine/Channel.html">EventMachine::Channel</a></li>
        
          <li><a href="../EventMachine/Completion.html">EventMachine::Completion</a></li>
        
          <li><a href="../EventMachine/Connection.html">EventMachine::Connection</a></li>
        
          <li><a href="../EventMachine/ConnectionError.html">EventMachine::ConnectionError</a></li>
        
          <li><a href="../EventMachine/ConnectionNotBound.html">EventMachine::ConnectionNotBound</a></li>
        
          <li><a href="../EventMachine/DNS.html">EventMachine::DNS</a></li>
        
          <li><a href="../EventMachine/DNS/Request.html">EventMachine::DNS::Request</a></li>
        
          <li><a href="../EventMachine/DNS/RequestIdAlreadyUsed.html">EventMachine::DNS::RequestIdAlreadyUsed</a></li>
        
          <li><a href="../EventMachine/DNS/Resolver.html">EventMachine::DNS::Resolver</a></li>
        
          <li><a href="../EventMachine/DNS/Socket.html">EventMachine::DNS::Socket</a></li>
        
          <li><a href="../EventMachine/DatagramObject.html">EventMachine::DatagramObject</a></li>
        
          <li><a href="../EventMachine/DefaultDeferrable.html">EventMachine::DefaultDeferrable</a></li>
        
          <li><a href="../EventMachine/Deferrable.html">EventMachine::Deferrable</a></li>
        
          <li><a href="../EventMachine/DeferrableChildProcess.html">EventMachine::DeferrableChildProcess</a></li>
        
          <li><a href="../EventMachine/Error.html">EventMachine::Error</a></li>
        
          <li><a href="../EventMachine/EvmaKeyboard.html">EventMachine::EvmaKeyboard</a></li>
        
          <li><a href="../EventMachine/EvmaTCPClient.html">EventMachine::EvmaTCPClient</a></li>
        
          <li><a href="../EventMachine/EvmaTCPServer.html">EventMachine::EvmaTCPServer</a></li>
        
          <li><a href="../EventMachine/EvmaUDPSocket.html">EventMachine::EvmaUDPSocket</a></li>
        
          <li><a href="../EventMachine/EvmaUNIXClient.html">EventMachine::EvmaUNIXClient</a></li>
        
          <li><a href="../EventMachine/EvmaUNIXServer.html">EventMachine::EvmaUNIXServer</a></li>
        
          <li><a href="../EventMachine/FileNotFoundException.html">EventMachine::FileNotFoundException</a></li>
        
          <li><a href="../EventMachine/FileStreamer.html">EventMachine::FileStreamer</a></li>
        
          <li><a href="../EventMachine/FileWatch.html">EventMachine::FileWatch</a></li>
        
          <li><a href="../EventMachine/Iterator.html">EventMachine::Iterator</a></li>
        
          <li><a href="../EventMachine/LoopbreakReader.html">EventMachine::LoopbreakReader</a></li>
        
          <li><a href="../EventMachine/PeriodicTimer.html">EventMachine::PeriodicTimer</a></li>
        
          <li><a href="../EventMachine/Pool.html">EventMachine::Pool</a></li>
        
          <li><a href="../EventMachine/ProcessWatch.html">EventMachine::ProcessWatch</a></li>
        
          <li><a href="../EventMachine/Protocols.html">EventMachine::Protocols</a></li>
        
          <li><a href="../EventMachine/Protocols.html">EventMachine::Protocols</a></li>
        
          <li><a href="../EventMachine/Protocols/HeaderAndContentProtocol.html">EventMachine::Protocols::HeaderAndContentProtocol</a></li>
        
          <li><a href="../EventMachine/Protocols/HttpClient.html">EventMachine::Protocols::HttpClient</a></li>
        
          <li><a href="../EventMachine/Protocols/HttpClient2.html">EventMachine::Protocols::HttpClient2</a></li>
        
          <li><a href="../EventMachine/Protocols/HttpClient2/Request.html">EventMachine::Protocols::HttpClient2::Request</a></li>
        
          <li><a href="../EventMachine/Protocols/LineAndTextProtocol.html">EventMachine::Protocols::LineAndTextProtocol</a></li>
        
          <li><a href="../EventMachine/Protocols/LineProtocol.html">EventMachine::Protocols::LineProtocol</a></li>
        
          <li><a href="../EventMachine/Protocols/LineText2.html">EventMachine::Protocols::LineText2</a></li>
        
          <li><a href="../EventMachine/Protocols/Memcache.html">EventMachine::Protocols::Memcache</a></li>
        
          <li><a href="../EventMachine/Protocols/Memcache/ParserError.html">EventMachine::Protocols::Memcache::ParserError</a></li>
        
          <li><a href="../EventMachine/Protocols/ObjectProtocol.html">EventMachine::Protocols::ObjectProtocol</a></li>
        
          <li><a href="../EventMachine/Protocols/Postgres3.html">EventMachine::Protocols::Postgres3</a></li>
        
          <li><a href="../EventMachine/Protocols/SASLauth.html">EventMachine::Protocols::SASLauth</a></li>
        
          <li><a href="../EventMachine/Protocols/SASLauthclient.html">EventMachine::Protocols::SASLauthclient</a></li>
        
          <li><a href="../EventMachine/Protocols/SmtpClient.html">EventMachine::Protocols::SmtpClient</a></li>
        
          <li><a href="../EventMachine/Protocols/SmtpServer.html">EventMachine::Protocols::SmtpServer</a></li>
        
          <li><a href="../EventMachine/Protocols/Socks4.html">EventMachine::Protocols::Socks4</a></li>
        
          <li><a href="../EventMachine/Protocols/Stomp.html">EventMachine::Protocols::Stomp</a></li>
        
          <li><a href="../EventMachine/Protocols/Stomp/Message.html">EventMachine::Protocols::Stomp::Message</a></li>
        
          <li><a href="../EventMachine/Protocols/TcpConnectTester.html">EventMachine::Protocols::TcpConnectTester</a></li>
        
          <li><a href="../EventMachine/Queue.html">EventMachine::Queue</a></li>
        
          <li><a href="../EventMachine/Reactor.html">EventMachine::Reactor</a></li>
        
          <li><a href="../EventMachine/Selectable.html">EventMachine::Selectable</a></li>
        
          <li><a href="../EventMachine/SpawnedProcess.html">EventMachine::SpawnedProcess</a></li>
        
          <li><a href="../EventMachine/StreamObject.html">EventMachine::StreamObject</a></li>
        
          <li><a href="../EventMachine/SystemCmd.html">EventMachine::SystemCmd</a></li>
        
          <li><a href="../EventMachine/ThreadedResource.html">EventMachine::ThreadedResource</a></li>
        
          <li><a href="../EventMachine/TickLoop.html">EventMachine::TickLoop</a></li>
        
          <li><a href="../EventMachine/Timer.html">EventMachine::Timer</a></li>
        
          <li><a href="../EventMachine/UnknownTimerFired.html">EventMachine::UnknownTimerFired</a></li>
        
          <li><a href="../EventMachine/Unsupported.html">EventMachine::Unsupported</a></li>
        
          <li><a href="../EventMachine/UuidGenerator.html">EventMachine::UuidGenerator</a></li>
        
          <li><a href="../EventMachine/YieldBlockFromSpawnedProcess.html">EventMachine::YieldBlockFromSpawnedProcess</a></li>
        
          <li><a href="../Object.html">Object</a></li>
        
          <li><a href="../EventMachine.html">Object::EM</a></li>
        
          <li><a href="../EventMachine/Protocols.html">Object::P</a></li>
        
          <li><a href="../BufferedTokenizer.html">BufferedTokenizer</a></li>
        
          <li><a href="../IO.html">IO</a></li>
        
          <li><a href="../StringIO.html">StringIO</a></li>
        
          <li><a href="../TestConnection.html">TestConnection</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">EventMachine::Connection</h1>

    <div id="description" class="description">
      
<p><a href="Connection.html">EventMachine::Connection</a> is a class that is
instantiated by EventMachine's processing loop whenever a new connection is
created. (New connections can be either initiated locally to a remote
server or accepted locally from a remote client.) When a <a
href="Connection.html">Connection</a> object is instantiated, it <em>mixes
in</em> the functionality contained in the user-defined module specified in
calls to {<a
href="../EventMachine.html#method-c-connect">EventMachine.connect</a>} or
{<a
href="../EventMachine.html#method-c-start_server">EventMachine.start_server</a>}.
User-defined handler modules may redefine any or all of the standard
methods defined here, as well as add arbitrary additional code that will
also be mixed in.</p>

<p><a href="../EventMachine.html">EventMachine</a> manages one object
inherited from <a href="Connection.html">EventMachine::Connection</a> (and
containing the mixed-in user code) for every network connection that is
active at any given time. The event loop will automatically call methods on
<a href="Connection.html">EventMachine::Connection</a> objects whenever
specific events occur on the corresponding connections, as described below.</p>

<p>This class is never instantiated by user code, and does not publish an
initialize method. The instance methods of <a
href="Connection.html">EventMachine::Connection</a> which may be called by
the event loop are:</p>
<ul><li>
<p>{<a href="Connection.html#method-i-post_init">post_init</a>}</p>
</li><li>
<p>{<a
href="Connection.html#method-i-connection_completed">connection_completed</a>}</p>
</li><li>
<p>{<a href="Connection.html#method-i-receive_data">receive_data</a>}</p>
</li><li>
<p>{<a href="Connection.html#method-i-unbind">unbind</a>}</p>
</li><li>
<p>{<a href="Connection.html#method-i-ssl_verify_peer">ssl_verify_peer</a>}
(if TLS is used)</p>
</li><li>
<p>{<a
href="Connection.html#method-i-ssl_handshake_completed">ssl_handshake_completed</a>}</p>
</li></ul>

<p>All of the other instance methods defined here are called  only by user
code.</p>

<p>@see file:<a
href="../docs/GettingStarted_md.html">docs/GettingStarted.md</a> <a
href="../EventMachine.html">EventMachine</a> tutorial</p>
<hr style="height: 1px">

<p>@private</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="signature-attribute-method" class="method-detail">
          <a name="signature"></a>
          
          <a name="signature="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">signature</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          <p>@private</p>
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(sig, *args)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Override .new so subclasses don’t have to call super and can ignore
connection-specific arguments</p>

<p>@private</p>
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 48</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sig</span>, *<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">allocate</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># Store signature</span>
    <span class="ruby-ivar">@signature</span> = <span class="ruby-identifier">sig</span>
    <span class="ruby-comment"># associate_callback_target sig</span>

    <span class="ruby-comment"># Call a superclass's #initialize if it has one</span>
    <span class="ruby-identifier">initialize</span>(*<span class="ruby-identifier">args</span>)

    <span class="ruby-comment"># post initialize callback</span>
    <span class="ruby-identifier">post_init</span>

    <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(*args)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Stubbed initialize so legacy superclasses can safely call super</p>

<p>@private</p>
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 67</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(*<span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="close_connection-method" class="method-detail ">
          <a name="method-i-close_connection"></a>

          
          <div class="method-heading">
            <span class="method-name">close_connection</span><span
              class="method-args">(after_writing = false)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p><a
href="Connection.html#method-i-close_connection">EventMachine::Connection#close_connection</a>
is called only by user code, and never by the event loop. You may call this
method against a connection object in any callback handler, whether or not
the callback was made against the connection you want to close. <a
href="Connection.html#method-i-close_connection">close_connection</a>
<em>schedules</em> the connection to be closed at the next available
opportunity within the event loop. You may not assume that the connection
is closed when <a
href="Connection.html#method-i-close_connection">close_connection</a>
returns. In particular, the framework will callback the unbind method for
the particular connection at a point shortly after you call
close_connection. You may assume that the unbind callback will take place
sometime after your call to <a
href="Connection.html#method-i-close_connection">close_connection</a>
completes. In other words, the unbind callback will not re-enter your code
"inside" of your call to close_connection. However, it's not guaranteed
that a future version of <a href="../EventMachine.html">EventMachine</a>
will not change this behavior.</p>

<p>{<a href="Connection.html#method-i-close_connection">close_connection</a>}
will *silently discard* any outbound data which you have sent to the
connection using {<a
href="Connection.html#method-i-send_data">EventMachine::Connection#send_data</a>}
but which has not yet been sent across the network. If you want to avoid
this behavior, use {<a
href="Connection.html#method-i-close_connection_after_writing">EventMachine::Connection#close_connection_after_writing</a>}.</p>
            

            
            <div class="method-source-code" id="close_connection-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 265</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">close_connection</span> <span class="ruby-identifier">after_writing</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">close_connection</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">after_writing</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- close_connection-source -->
            
          </div>

          

          
        </div><!-- close_connection-method -->

      
        <div id="close_connection_after_writing-method" class="method-detail ">
          <a name="method-i-close_connection_after_writing"></a>

          
          <div class="method-heading">
            <span class="method-name">close_connection_after_writing</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>A variant of {<a
href="Connection.html#method-i-close_connection">close_connection</a>}. All
of the descriptive comments given for <a
href="Connection.html#method-i-close_connection">close_connection</a> also
apply to <a
href="Connection.html#method-i-close_connection_after_writing">close_connection_after_writing</a>,
*with one exception*: if the connection has outbound data sent using
send_dat but which has not yet been sent across the network, <a
href="Connection.html#method-i-close_connection_after_writing">close_connection_after_writing</a>
will schedule the connection to be closed <b>after</b> all of the outbound
data has been safely written to the remote peer.</p>

<p>Depending on the amount of outgoing data and the speed of the network,
considerable time may elapse between your call to <a
href="Connection.html#method-i-close_connection_after_writing">close_connection_after_writing</a>
and the actual closing of the socket (at which time the unbind callback
will be called by the event loop). During this time, you *may not* call <a
href="Connection.html#method-i-send_data">send_data</a> to transmit
additional data (that is, the connection is closed for further writes). In
very rare cases, you may experience a <a
href="Connection.html#method-i-receive_data">receive_data</a> callback
after your call to {<a
href="Connection.html#method-i-close_connection_after_writing">close_connection_after_writing</a>},
depending on whether incoming data was in the process of being received on
the connection at the moment when you called {<a
href="Connection.html#method-i-close_connection_after_writing">close_connection_after_writing</a>}.
Your protocol handler must be prepared to properly deal with such data
(probably by ignoring it).</p>

<p>@see <a
href="Connection.html#method-i-close_connection">close_connection</a> @see
<a href="Connection.html#method-i-send_data">send_data</a></p>
            

            
            <div class="method-source-code" id="close_connection_after_writing-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 302</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">close_connection_after_writing</span>
  <span class="ruby-identifier">close_connection</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- close_connection_after_writing-source -->
            
          </div>

          

          
        </div><!-- close_connection_after_writing-method -->

      
        <div id="comm_inactivity_timeout-method" class="method-detail ">
          <a name="method-i-comm_inactivity_timeout"></a>

          
          <div class="method-heading">
            <span class="method-name">comm_inactivity_timeout</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p><a
href="Connection.html#method-i-comm_inactivity_timeout">comm_inactivity_timeout</a>
returns the current value (float in seconds) of the inactivity-timeout
property of network-connection and datagram-socket objects. A nonzero value
indicates that the connection or socket will automatically be closed if no
read or write activity takes place for at least that number of seconds. A
zero value (the default) specifies that no automatic timeout will take
place.</p>
            

            
            <div class="method-source-code" id="comm_inactivity_timeout-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 647</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">comm_inactivity_timeout</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_comm_inactivity_timeout</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- comm_inactivity_timeout-source -->
            
          </div>

          

          
        </div><!-- comm_inactivity_timeout-method -->

      
        <div id="comm_inactivity_timeout-3D-method" class="method-detail ">
          <a name="method-i-comm_inactivity_timeout-3D"></a>

          
          <div class="method-heading">
            <span class="method-name">comm_inactivity_timeout=</span><span
              class="method-args">(value)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Allows you to set the inactivity-timeout property for a network connection
or datagram socket. Specify a non-negative float value in seconds. If the
value is greater than zero, the connection or socket will automatically be
closed if no read or write activity takes place for at least that number of
seconds. Specify a value of zero to indicate that no automatic timeout
should take place. Zero is the default value.</p>
            

            
            <div class="method-source-code" id="comm_inactivity_timeout-3D-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 657</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">comm_inactivity_timeout=</span> <span class="ruby-identifier">value</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">set_comm_inactivity_timeout</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_f</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- comm_inactivity_timeout-3D-source -->
            
          </div>

          
          <div class="aliases">
            Also aliased as: <a href="Connection.html#method-i-set_comm_inactivity_timeout">set_comm_inactivity_timeout</a>
          </div>
          

          
        </div><!-- comm_inactivity_timeout-3D-method -->

      
        <div id="connection_completed-method" class="method-detail ">
          <a name="method-i-connection_completed"></a>

          
          <div class="method-heading">
            <span class="method-name">connection_completed</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Called by the event loop when a remote TCP connection attempt completes
successfully. You can expect to get this notification after calls to {<a
href="../EventMachine.html#method-c-connect">EventMachine.connect</a>}.
Remember that <a href="../EventMachine.html">EventMachine</a> makes remote
connections asynchronously, just as with any other kind of network event.
This method is intended primarily to assist with network diagnostics. For
normal protocol handling, use <a
href="Connection.html#method-i-post_init">post_init</a> to perform initial
work on a new connection (such as sending initial set of data). {<a
href="Connection.html#method-i-post_init">Connection#post_init</a>} will
always be called. This method will only be called in case of a successful
completion. A connection attempt which fails will result a call to {<a
href="Connection.html#method-i-unbind">Connection#unbind</a>} after the
failure.</p>

<p>@see <a href="Connection.html#method-i-post_init">Connection#post_init</a>
@see <a href="Connection.html#method-i-unbind">Connection#unbind</a> @see
file:<a href="../docs/GettingStarted_md.html">docs/GettingStarted.md</a> <a
href="../EventMachine.html">EventMachine</a> tutorial</p>
            

            
            <div class="method-source-code" id="connection_completed-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 362</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">connection_completed</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- connection_completed-source -->
            
          </div>

          

          
        </div><!-- connection_completed-method -->

      
        <div id="detach-method" class="method-detail ">
          <a name="method-i-detach"></a>

          
          <div class="method-heading">
            <span class="method-name">detach</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Removes given connection from the event loop. The connection’s socket
remains open and its file descriptor number is returned.</p>
            

            
            <div class="method-source-code" id="detach-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 271</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">detach</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">detach_fd</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- detach-source -->
            
          </div>

          

          
        </div><!-- detach-method -->

      
        <div id="error-3F-method" class="method-detail ">
          <a name="method-i-error-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">error?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Returns true if the connection is in an error state, false otherwise.</p>

<p>In general, you can detect the occurrence of communication errors or
unexpected disconnection by the remote peer by handing the {<a
href="Connection.html#method-i-unbind">unbind</a>} method. In some cases,
however, it’s useful to check the status of the connection using {<a
href="Connection.html#method-i-error-3F">error?</a>} before attempting to
send data. This function is synchronous but it will return immediately
without blocking.</p>

<p>@return [Boolean] true if the connection is in an error state, false
otherwise</p>
            

            
            <div class="method-source-code" id="error-3F-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 339</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">error?</span>
  <span class="ruby-identifier">errno</span> = <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">report_connection_error_status</span>(<span class="ruby-ivar">@signature</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">errno</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">0</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">-1</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">ERRNOS</span>[<span class="ruby-identifier">errno</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- error-3F-source -->
            
          </div>

          

          
        </div><!-- error-3F-method -->

      
        <div id="get_cipher_bits-method" class="method-detail ">
          <a name="method-i-get_cipher_bits"></a>

          
          <div class="method-heading">
            <span class="method-name">get_cipher_bits</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="get_cipher_bits-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 534</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_cipher_bits</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_cipher_bits</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_cipher_bits-source -->
            
          </div>

          

          
        </div><!-- get_cipher_bits-method -->

      
        <div id="get_cipher_name-method" class="method-detail ">
          <a name="method-i-get_cipher_name"></a>

          
          <div class="method-heading">
            <span class="method-name">get_cipher_name</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="get_cipher_name-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 538</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_cipher_name</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_cipher_name</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_cipher_name-source -->
            
          </div>

          

          
        </div><!-- get_cipher_name-method -->

      
        <div id="get_cipher_protocol-method" class="method-detail ">
          <a name="method-i-get_cipher_protocol"></a>

          
          <div class="method-heading">
            <span class="method-name">get_cipher_protocol</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="get_cipher_protocol-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 542</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_cipher_protocol</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_cipher_protocol</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_cipher_protocol-source -->
            
          </div>

          

          
        </div><!-- get_cipher_protocol-method -->

      
        <div id="get_idle_time-method" class="method-detail ">
          <a name="method-i-get_idle_time"></a>

          
          <div class="method-heading">
            <span class="method-name">get_idle_time</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>The number of seconds since the last send/receive activity on this
connection.</p>
            

            
            <div class="method-source-code" id="get_idle_time-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 638</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_idle_time</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_idle_time</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_idle_time-source -->
            
          </div>

          

          
        </div><!-- get_idle_time-method -->

      
        <div id="get_outbound_data_size-method" class="method-detail ">
          <a name="method-i-get_outbound_data_size"></a>

          
          <div class="method-heading">
            <span class="method-name">get_outbound_data_size</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>@private</p>
            

            
            <div class="method-source-code" id="get_outbound_data_size-source">
<pre>
<span class="ruby-comment"># File lib/em/pure_ruby.rb, line 434</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_outbound_data_size</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_outbound_data_size</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_outbound_data_size-source -->
            
          </div>

          

          
        </div><!-- get_outbound_data_size-method -->

      
        <div id="get_peer_cert-method" class="method-detail ">
          <a name="method-i-get_peer_cert"></a>

          
          <div class="method-heading">
            <span class="method-name">get_peer_cert</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>If [TLS](<a
href="http://en.wikipedia.org/wiki/Transport_Layer_Security">en.wikipedia.org/wiki/Transport_Layer_Security</a>)
is active on the connection, returns the remote [X509 certificate](<a
href="http://en.wikipedia.org/wiki/X.509">en.wikipedia.org/wiki/X.509</a>)
as a string, in the popular [PEM format](<a
href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">en.wikipedia.org/wiki/Privacy_Enhanced_Mail</a>).
This can then be used for arbitrary validation of a peer’s certificate in
your code.</p>

<p>This should be called in/after the {<a
href="Connection.html#method-i-ssl_handshake_completed">ssl_handshake_completed</a>}
callback, which indicates that SSL/TLS is active. Using this callback is
important, because the certificate may not be available until the time it
is executed. Using <a
href="Connection.html#method-i-post_init">post_init</a> or <a
href="Connection.html#method-i-connection_completed">connection_completed</a>
is not adequate, because the SSL handshake may still be taking place.</p>

<p>This method will return `nil` if:</p>
<ul><li>
<p><a href="../EventMachine.html">EventMachine</a> is not built with
[OpenSSL](<a href="http://www.openssl.org">www.openssl.org</a>) support</p>
</li><li>
<p>[TLS](<a
href="http://en.wikipedia.org/wiki/Transport_Layer_Security">en.wikipedia.org/wiki/Transport_Layer_Security</a>)
is not active on the connection</p>
</li><li>
<p>TLS handshake is not yet complete</p>
</li><li>
<p>Remote peer for any other reason has not presented a certificate</p>
</li></ul>

<p>@example Getting peer TLS certificate information in <a
href="../EventMachine.html">EventMachine</a></p>

<pre>module Handler
  def post_init
    puts &quot;Starting TLS&quot;
    start_tls
  end

  def ssl_handshake_completed
    puts get_peer_cert
    close_connection
  end

  def unbind
    EventMachine::stop_event_loop
  end
end

 EventMachine.run do
   EventMachine.connect &quot;mail.google.com&quot;, 443, Handler
end

# Will output:
# -----BEGIN CERTIFICATE-----
# MIIDIjCCAougAwIBAgIQbldpChBPqv+BdPg4iwgN8TANBgkqhkiG9w0BAQUFADBM
# MQswCQYDVQQGEwJaQTElMCMGA1UEChMcVGhhd3RlIENvbnN1bHRpbmcgKFB0eSkg
# THRkLjEWMBQGA1UEAxMNVGhhd3RlIFNHQyBDQTAeFw0wODA1MDIxNjMyNTRaFw0w
# OTA1MDIxNjMyNTRaMGkxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlh
# MRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRMwEQYDVQQKEwpHb29nbGUgSW5jMRgw
# FgYDVQQDEw9tYWlsLmdvb2dsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJ
# AoGBALlkxdh2QXegdElukCSOV2+8PKiONIS+8Tu9K7MQsYpqtLNC860zwOPQ2NLI
# 3Zp4jwuXVTrtzGuiqf5Jioh35Ig3CqDXtLyZoypjZUQcq4mlLzHlhIQ4EhSjDmA7
# Ffw9y3ckSOQgdBQWNLbquHh9AbEUjmhkrYxIqKXeCnRKhv6nAgMBAAGjgecwgeQw
# KAYDVR0lBCEwHwYIKwYBBQUHAwEGCCsGAQUFBwMCBglghkgBhvhCBAEwNgYDVR0f
# BC8wLTAroCmgJ4YlaHR0cDovL2NybC50aGF3dGUuY29tL1RoYXd0ZVNHQ0NBLmNy
# bDByBggrBgEFBQcBAQRmMGQwIgYIKwYBBQUHMAGGFmh0dHA6Ly9vY3NwLnRoYXd0
# ZS5jb20wPgYIKwYBBQUHMAKGMmh0dHA6Ly93d3cudGhhd3RlLmNvbS9yZXBvc2l0
# b3J5L1RoYXd0ZV9TR0NfQ0EuY3J0MAwGA1UdEwEB/wQCMAAwDQYJKoZIhvcNAQEF
# BQADgYEAsRwpLg1dgCR1gYDK185MFGukXMeQFUvhGqF8eT/CjpdvezyKVuz84gSu
# 6ccMXgcPQZGQN/F4Xug+Q01eccJjRSVfdvR5qwpqCj+6BFl5oiKDBsveSkrmL5dz
# s2bn7TdTSYKcLeBkjXxDLHGBqLJ6TNCJ3c4/cbbG5JhGvoema94=
# -----END CERTIFICATE-----</pre>

<p>You can do whatever you want with the certificate String, such as load it
as a certificate object using the OpenSSL library, and check its fields.</p>

<p>@return [String] the remote [X509 certificate](<a
href="http://en.wikipedia.org/wiki/X.509">en.wikipedia.org/wiki/X.509</a>),
in the popular [PEM format](<a
href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">en.wikipedia.org/wiki/Privacy_Enhanced_Mail</a>),</p>

<pre>if TLS is active on the connection</pre>

<p>@see <a href="Connection.html#method-i-start_tls">Connection#start_tls</a>
@see <a
href="Connection.html#method-i-ssl_handshake_completed">Connection#ssl_handshake_completed</a></p>
            

            
            <div class="method-source-code" id="get_peer_cert-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 530</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_peer_cert</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_peer_cert</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_peer_cert-source -->
            
          </div>

          

          
        </div><!-- get_peer_cert-method -->

      
        <div id="get_peername-method" class="method-detail ">
          <a name="method-i-get_peername"></a>

          
          <div class="method-heading">
            <span class="method-name">get_peername</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>This method is used with stream-connections to obtain the identity of the
remotely-connected peer. If a peername is available, this method returns a
sockaddr structure. The method returns nil if no peername is available. You
can use Socket.unpack_sockaddr_in and its variants to obtain the values
contained in the peername structure returned from <a
href="Connection.html#method-i-get_peername">get_peername</a>.</p>

<p>@example How to get peer IP address and port with <a
href="../EventMachine.html">EventMachine</a></p>

<pre>require 'socket'

module Handler
  def receive_data data
    port, ip = Socket.unpack_sockaddr_in(get_peername)
    puts &quot;got #{data.inspect} from #{ip}:#{port}&quot;
  end
end</pre>
            

            
            <div class="method-source-code" id="get_peername-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 596</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_peername</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_peername</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_peername-source -->
            
          </div>

          

          
        </div><!-- get_peername-method -->

      
        <div id="get_pid-method" class="method-detail ">
          <a name="method-i-get_pid"></a>

          
          <div class="method-heading">
            <span class="method-name">get_pid</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Returns the PID (kernel process identifier) of a subprocess associated with
this <a href="Connection.html">Connection</a> object. For use with {<a
href="../EventMachine.html#method-c-popen">EventMachine.popen</a>} and
similar methods. Returns nil when there is no meaningful subprocess.</p>

<p>@return [Integer]</p>
            

            
            <div class="method-source-code" id="get_pid-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 625</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_pid</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_subprocess_pid</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_pid-source -->
            
          </div>

          

          
        </div><!-- get_pid-method -->

      
        <div id="get_proxied_bytes-method" class="method-detail ">
          <a name="method-i-get_proxied_bytes"></a>

          
          <div class="method-heading">
            <span class="method-name">get_proxied_bytes</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>The number of bytes proxied to another connection. Reset to zero when <a
href="Connection.html#method-i-proxy_incoming_to">EventMachine::Connection#proxy_incoming_to</a>
is called, and incremented whenever data is proxied.</p>
            

            
            <div class="method-source-code" id="get_proxied_bytes-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 243</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_proxied_bytes</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_proxied_bytes</span>(<span class="ruby-ivar">@signature</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_proxied_bytes-source -->
            
          </div>

          

          
        </div><!-- get_proxied_bytes-method -->

      
        <div id="get_sni_hostname-method" class="method-detail ">
          <a name="method-i-get_sni_hostname"></a>

          
          <div class="method-heading">
            <span class="method-name">get_sni_hostname</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="get_sni_hostname-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 546</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sni_hostname</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_sni_hostname</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_sni_hostname-source -->
            
          </div>

          

          
        </div><!-- get_sni_hostname-method -->

      
        <div id="get_sock_opt-method" class="method-detail ">
          <a name="method-i-get_sock_opt"></a>

          
          <div class="method-heading">
            <span class="method-name">get_sock_opt</span><span
              class="method-args">(level, option)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="get_sock_opt-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 275</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sock_opt</span> <span class="ruby-identifier">level</span>, <span class="ruby-identifier">option</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_sock_opt</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">level</span>, <span class="ruby-identifier">option</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_sock_opt-source -->
            
          </div>

          

          
        </div><!-- get_sock_opt-method -->

      
        <div id="get_sockname-method" class="method-detail ">
          <a name="method-i-get_sockname"></a>

          
          <div class="method-heading">
            <span class="method-name">get_sockname</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Used with stream-connections to obtain the identity of the local side of
the connection. If a local name is available, this method returns a
sockaddr structure. The method returns nil if no local name is available.
You can use {Socket.unpack_sockaddr_in} and its variants to obtain the
values contained in the local-name structure returned from this method.</p>

<p>@example</p>

<pre>require 'socket'

module Handler
  def receive_data data
    port, ip = Socket.unpack_sockaddr_in(get_sockname)
    puts &quot;got #{data.inspect}&quot;
  end
end</pre>
            

            
            <div class="method-source-code" id="get_sockname-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 616</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sockname</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_sockname</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_sockname-source -->
            
          </div>

          

          
        </div><!-- get_sockname-method -->

      
        <div id="get_status-method" class="method-detail ">
          <a name="method-i-get_status"></a>

          
          <div class="method-heading">
            <span class="method-name">get_status</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Returns a subprocess exit status. Only useful for {<a
href="../EventMachine.html#method-c-popen">EventMachine.popen</a>}. Call it
in your {<a href="Connection.html#method-i-unbind">unbind</a>} handler.</p>

<p>@return [Integer]</p>
            

            
            <div class="method-source-code" id="get_status-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 633</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_status</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_subprocess_status</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get_status-source -->
            
          </div>

          

          
        </div><!-- get_status-method -->

      
        <div id="notify_readable-3D-method" class="method-detail ">
          <a name="method-i-notify_readable-3D"></a>

          
          <div class="method-heading">
            <span class="method-name">notify_readable=</span><span
              class="method-args">(mode)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Watches connection for readability. Only possible if the connection was
created using {<a
href="../EventMachine.html#method-c-attach">EventMachine.attach</a>} and
had {EventMachine.notify_readable}/{EventMachine.notify_writable} defined
on the handler.</p>

<p>@see <a
href="Connection.html#method-i-notify_readable-3F">notify_readable?</a></p>
            

            
            <div class="method-source-code" id="notify_readable-3D-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 729</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notify_readable=</span> <span class="ruby-identifier">mode</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">set_notify_readable</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">mode</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- notify_readable-3D-source -->
            
          </div>

          

          
        </div><!-- notify_readable-3D-method -->

      
        <div id="notify_readable-3F-method" class="method-detail ">
          <a name="method-i-notify_readable-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">notify_readable?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>@return [Boolean] true if the connection is being watched for readability.</p>
            

            
            <div class="method-source-code" id="notify_readable-3F-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 734</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notify_readable?</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">is_notify_readable</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- notify_readable-3F-source -->
            
          </div>

          

          
        </div><!-- notify_readable-3F-method -->

      
        <div id="notify_writable-3D-method" class="method-detail ">
          <a name="method-i-notify_writable-3D"></a>

          
          <div class="method-heading">
            <span class="method-name">notify_writable=</span><span
              class="method-args">(mode)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Watches connection for writeability. Only possible if the connection was
created using {<a
href="../EventMachine.html#method-c-attach">EventMachine.attach</a>} and
had {EventMachine.notify_readable}/{EventMachine.notify_writable} defined
on the handler.</p>

<p>@see <a
href="Connection.html#method-i-notify_writable-3F">notify_writable?</a></p>
            

            
            <div class="method-source-code" id="notify_writable-3D-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 742</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notify_writable=</span> <span class="ruby-identifier">mode</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">set_notify_writable</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">mode</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- notify_writable-3D-source -->
            
          </div>

          

          
        </div><!-- notify_writable-3D-method -->

      
        <div id="notify_writable-3F-method" class="method-detail ">
          <a name="method-i-notify_writable-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">notify_writable?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Returns true if the connection is being watched for writability.</p>
            

            
            <div class="method-source-code" id="notify_writable-3F-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 747</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">notify_writable?</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">is_notify_writable</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- notify_writable-3F-source -->
            
          </div>

          

          
        </div><!-- notify_writable-3F-method -->

      
        <div id="pause-method" class="method-detail ">
          <a name="method-i-pause"></a>

          
          <div class="method-heading">
            <span class="method-name">pause</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Pause a connection so that {<a
href="Connection.html#method-i-send_data">send_data</a>} and {<a
href="Connection.html#method-i-receive_data">receive_data</a>} events are
not fired until {<a href="Connection.html#method-i-resume">resume</a>} is
called. @see <a href="Connection.html#method-i-resume">resume</a></p>
            

            
            <div class="method-source-code" id="pause-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 753</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pause</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">pause_connection</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- pause-source -->
            
          </div>

          

          
        </div><!-- pause-method -->

      
        <div id="paused-3F-method" class="method-detail ">
          <a name="method-i-paused-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">paused?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>@return [Boolean] true if the connect was paused using {<a
href="Connection.html#method-i-pause">EventMachine::Connection#pause</a>}.
@see <a href="Connection.html#method-i-pause">pause</a> @see <a
href="Connection.html#method-i-resume">resume</a></p>
            

            
            <div class="method-source-code" id="paused-3F-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 766</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">paused?</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">connection_paused?</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- paused-3F-source -->
            
          </div>

          

          
        </div><!-- paused-3F-method -->

      
        <div id="pending_connect_timeout-method" class="method-detail ">
          <a name="method-i-pending_connect_timeout"></a>

          
          <div class="method-heading">
            <span class="method-name">pending_connect_timeout</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>The duration after which a TCP connection in the connecting state will
fail. It is important to distinguish this value from {<a
href="Connection.html#method-i-comm_inactivity_timeout">EventMachine::Connection#comm_inactivity_timeout</a>},
which looks at how long since data was passed on an already established
connection. The value is a float in seconds.</p>

<p>@return [Float] The duration after which a TCP connection in the connecting
state will fail, in seconds.</p>
            

            
            <div class="method-source-code" id="pending_connect_timeout-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 668</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pending_connect_timeout</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_pending_connect_timeout</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- pending_connect_timeout-source -->
            
          </div>

          

          
        </div><!-- pending_connect_timeout-method -->

      
        <div id="pending_connect_timeout-3D-method" class="method-detail ">
          <a name="method-i-pending_connect_timeout-3D"></a>

          
          <div class="method-heading">
            <span class="method-name">pending_connect_timeout=</span><span
              class="method-args">(value)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Sets the duration after which a TCP connection in a connecting state will
fail.</p>

<p>@param [Float, to_f] value <a href="Connection.html">Connection</a> timeout
in seconds</p>
            

            
            <div class="method-source-code" id="pending_connect_timeout-3D-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 676</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pending_connect_timeout=</span> <span class="ruby-identifier">value</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">set_pending_connect_timeout</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_f</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- pending_connect_timeout-3D-source -->
            
          </div>

          
          <div class="aliases">
            Also aliased as: <a href="Connection.html#method-i-set_pending_connect_timeout">set_pending_connect_timeout</a>
          </div>
          

          
        </div><!-- pending_connect_timeout-3D-method -->

      
        <div id="post_init-method" class="method-detail ">
          <a name="method-i-post_init"></a>

          
          <div class="method-heading">
            <span class="method-name">post_init</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Called by the event loop immediately after the network connection has been
established, and before resumption of the network loop. This method is
generally not called by user code, but is called automatically by the event
loop. The base-class implementation is a no-op. This is a very good place
to initialize instance variables that will be used throughout the lifetime
of the network connection.</p>

<p>@see <a
href="Connection.html#method-i-connection_completed">connection_completed</a>
@see <a href="Connection.html#method-i-unbind">unbind</a> @see <a
href="Connection.html#method-i-send_data">send_data</a> @see <a
href="Connection.html#method-i-receive_data">receive_data</a></p>
            

            
            <div class="method-source-code" id="post_init-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 81</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post_init</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- post_init-source -->
            
          </div>

          

          
        </div><!-- post_init-method -->

      
        <div id="proxy_completed-method" class="method-detail ">
          <a name="method-i-proxy_completed"></a>

          
          <div class="method-heading">
            <span class="method-name">proxy_completed</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>called when the reactor finished proxying all of the requested bytes.</p>
            

            
            <div class="method-source-code" id="proxy_completed-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 224</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">proxy_completed</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- proxy_completed-source -->
            
          </div>

          

          
        </div><!-- proxy_completed-method -->

      
        <div id="proxy_incoming_to-method" class="method-detail ">
          <a name="method-i-proxy_incoming_to"></a>

          
          <div class="method-heading">
            <span class="method-name">proxy_incoming_to</span><span
              class="method-args">(conn,bufsize=0)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p><a
href="Connection.html#method-i-proxy_incoming_to">EventMachine::Connection#proxy_incoming_to</a>
is called only by user code. It sets up a low-level proxy relay for all
data inbound for this connection, to the connection given as the argument.
This is essentially just a helper method for enable_proxy.</p>

<p>@see <a
href="../EventMachine.html#method-c-enable_proxy">EventMachine.enable_proxy</a></p>
            

            
            <div class="method-source-code" id="proxy_incoming_to-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 232</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">proxy_incoming_to</span>(<span class="ruby-identifier">conn</span>,<span class="ruby-identifier">bufsize</span>=<span class="ruby-value">0</span>)
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">enable_proxy</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">conn</span>, <span class="ruby-identifier">bufsize</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- proxy_incoming_to-source -->
            
          </div>

          

          
        </div><!-- proxy_incoming_to-method -->

      
        <div id="proxy_target_unbound-method" class="method-detail ">
          <a name="method-i-proxy_target_unbound"></a>

          
          <div class="method-heading">
            <span class="method-name">proxy_target_unbound</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Called by the reactor after attempting to relay incoming data to a
descriptor (set as a proxy target descriptor with {<a
href="../EventMachine.html#method-c-enable_proxy">EventMachine.enable_proxy</a>})
that has already been closed.</p>

<p>@see <a
href="../EventMachine.html#method-c-enable_proxy">EventMachine.enable_proxy</a></p>
            

            
            <div class="method-source-code" id="proxy_target_unbound-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">proxy_target_unbound</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- proxy_target_unbound-source -->
            
          </div>

          

          
        </div><!-- proxy_target_unbound-method -->

      
        <div id="receive_data-method" class="method-detail ">
          <a name="method-i-receive_data"></a>

          
          <div class="method-heading">
            <span class="method-name">receive_data</span><span
              class="method-args">(data)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Called by the event loop whenever data has been received by the network
connection. It is never called by user code. {<a
href="Connection.html#method-i-receive_data">receive_data</a>} is called
with a single parameter, a String containing the network protocol data,
which may of course be binary. You will generally redefine this method to
perform your own processing of the incoming data.</p>

<p>Here’s a key point which is essential to understanding the event-driven
programming model: <em><a href="../EventMachine.html">EventMachine</a>
knows absolutely nothing about the protocol which your code
implements.</em> You must not make any assumptions about the size of the
incoming data packets, or about their alignment on any particular
intra-message or PDU boundaries (such as line breaks). <a
href="Connection.html#method-i-receive_data">receive_data</a> can and will
send you arbitrary chunks of data, with the only guarantee being that the
data is presented to your code in the order it was collected from the
network. Don’t even assume that the chunks of data will correspond to
network packets, as <a href="../EventMachine.html">EventMachine</a> can and
will coalesce several incoming packets into one, to improve performance.
The implication for your code is that you generally will need to implement
some kind of a state machine in your redefined implementation of
receive_data. For a better understanding of this, read through the examples
of specific protocol handlers in <a
href="Protocols.html">EventMachine::Protocols</a></p>

<p>The base-class implementation (which will be invoked only if you didn’t
override it in your protocol handler) simply prints incoming data packet
size to stdout.</p>

<p>@param [String] data Opaque incoming data. @note Depending on the protocol,
buffer sizes and OS networking stack configuration, incoming data may or
may not be “a complete message”.</p>

<pre>It is up to this handler to detect content boundaries to determine whether all the content (for example, full HTTP request)
has been received and can be processed.</pre>

<p>@see <a href="Connection.html#method-i-post_init">post_init</a> @see <a
href="Connection.html#method-i-connection_completed">connection_completed</a>
@see <a href="Connection.html#method-i-unbind">unbind</a> @see <a
href="Connection.html#method-i-send_data">send_data</a> @see file:<a
href="../docs/GettingStarted_md.html">docs/GettingStarted.md</a> <a
href="../EventMachine.html">EventMachine</a> tutorial</p>
            

            
            <div class="method-source-code" id="receive_data-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 116</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">receive_data</span> <span class="ruby-identifier">data</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;............&gt;&gt;&gt;#{data.length}&quot;</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- receive_data-source -->
            
          </div>

          

          
        </div><!-- receive_data-method -->

      
        <div id="reconnect-method" class="method-detail ">
          <a name="method-i-reconnect"></a>

          
          <div class="method-heading">
            <span class="method-name">reconnect</span><span
              class="method-args">(server, port)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Reconnect to a given host/port with the current instance</p>

<p>@param [String] server Hostname or IP address @param [Integer] port  Port
to reconnect to</p>
            

            
            <div class="method-source-code" id="reconnect-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 685</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reconnect</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">reconnect</span> <span class="ruby-identifier">server</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- reconnect-source -->
            
          </div>

          

          
        </div><!-- reconnect-method -->

      
        <div id="resume-method" class="method-detail ">
          <a name="method-i-resume"></a>

          
          <div class="method-heading">
            <span class="method-name">resume</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Resume a connection’s {<a
href="Connection.html#method-i-send_data">send_data</a>} and {<a
href="Connection.html#method-i-receive_data">receive_data</a>} events. @see
<a href="Connection.html#method-i-pause">pause</a></p>
            

            
            <div class="method-source-code" id="resume-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 759</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">resume</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">resume_connection</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- resume-source -->
            
          </div>

          

          
        </div><!-- resume-method -->

      
        <div id="send_data-method" class="method-detail ">
          <a name="method-i-send_data"></a>

          
          <div class="method-heading">
            <span class="method-name">send_data</span><span
              class="method-args">(data)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Call this method to send data to the remote end of the network connection.
It takes a single String argument, which may contain binary data. Data is
buffered to be sent at the end of this event loop tick (cycle).</p>

<p>When used in a method that is event handler (for example, {<a
href="Connection.html#method-i-post_init">post_init</a>} or {<a
href="Connection.html#method-i-connection_completed">connection_completed</a>},
it will send data to the other end of the connection that generated the
event. You can also call {<a
href="Connection.html#method-i-send_data">send_data</a>} to write to other
connections. For more information see The Chat Server Example in the
{file:<a href="../docs/GettingStarted_md.html">docs/GettingStarted.md</a>
<a href="../EventMachine.html">EventMachine</a> tutorial}.</p>

<p>If you want to send some data and then immediately close the connection,
make sure to use {<a
href="Connection.html#method-i-close_connection_after_writing">close_connection_after_writing</a>}
instead of {<a
href="Connection.html#method-i-close_connection">close_connection</a>}.</p>

<p>@param [String] data Data to send asynchronously</p>

<p>@see file:<a
href="../docs/GettingStarted_md.html">docs/GettingStarted.md</a> <a
href="../EventMachine.html">EventMachine</a> tutorial @see <a
href="Connection.html#method-i-receive_data">Connection#receive_data</a>
@see <a href="Connection.html#method-i-post_init">Connection#post_init</a>
@see <a href="Connection.html#method-i-unbind">Connection#unbind</a></p>
            

            
            <div class="method-source-code" id="send_data-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 324</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_data</span> <span class="ruby-identifier">data</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">size</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:bytesize</span>)
  <span class="ruby-identifier">size</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">send_data</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- send_data-source -->
            
          </div>

          

          
        </div><!-- send_data-method -->

      
        <div id="send_datagram-method" class="method-detail ">
          <a name="method-i-send_datagram"></a>

          
          <div class="method-heading">
            <span class="method-name">send_datagram</span><span
              class="method-args">(data, recipient_address, recipient_port)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Sends UDP messages.</p>

<p>This method may be called from any <a href="Connection.html">Connection</a>
object that refers to an open datagram socket (see
EventMachine#open_datagram_socket). The method sends a UDP (datagram)
packet containing the data you specify, to a remote peer specified by the
IP address and port that you give as parameters to the method. Observe that
you may send a zero-length packet (empty string). However, you may not send
an arbitrarily-large data packet because your operating system will enforce
a platform-specific limit on the size of the outbound packet. (Your kernel
will respond in a platform-specific way if you send an overlarge packet:
some will send a truncated packet, some will complain, and some will
silently drop your request). On LANs, it’s usually OK to send datagrams up
to about 4000 bytes in length, but to be really safe, send messages smaller
than the Ethernet-packet size (typically about 1400 bytes). Some very
restrictive WANs will either drop or truncate packets larger than about 500
bytes.</p>

<p>@param [String] data              Data to send asynchronously @param
[String] recipient_address IP address of the recipient @param [String]
recipient_port    Port of the recipient</p>
            

            
            <div class="method-source-code" id="send_datagram-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 572</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_datagram</span> <span class="ruby-identifier">data</span>, <span class="ruby-identifier">recipient_address</span>, <span class="ruby-identifier">recipient_port</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">size</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:bytesize</span>)
  <span class="ruby-identifier">size</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">send_datagram</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">size</span>, <span class="ruby-identifier">recipient_address</span>, <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">recipient_port</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- send_datagram-source -->
            
          </div>

          

          
        </div><!-- send_datagram-method -->

      
        <div id="send_file_data-method" class="method-detail ">
          <a name="method-i-send_file_data"></a>

          
          <div class="method-heading">
            <span class="method-name">send_file_data</span><span
              class="method-args">(filename)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Like {<a
href="Connection.html#method-i-send_data">EventMachine::Connection#send_data</a>},
this sends data to the remote end of the network connection. {<a
href="Connection.html#method-i-send_file_data">EventMachine::Connection#send_file_data</a>}
takes a filename as an argument, though, and sends the contents of the
file, in one chunk.</p>

<p>@param [String] filename Local path of the file to send</p>

<p>@see <a href="Connection.html#method-i-send_data">send_data</a> @author
Kirk Haines</p>
            

            
            <div class="method-source-code" id="send_file_data-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 699</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_file_data</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">send_file_data</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">filename</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- send_file_data-source -->
            
          </div>

          

          
        </div><!-- send_file_data-method -->

      
        <div id="set_comm_inactivity_timeout-method" class="method-detail method-alias">
          <a name="method-i-set_comm_inactivity_timeout"></a>

          
          <div class="method-heading">
            <span class="method-name">set_comm_inactivity_timeout</span><span
              class="method-args">(value)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
          </div>

          

          
          <div class="aliases">
            Alias for: <a href="Connection.html#method-i-comm_inactivity_timeout-3D">comm_inactivity_timeout=</a>
          </div>
          
        </div><!-- set_comm_inactivity_timeout-method -->

      
        <div id="set_pending_connect_timeout-method" class="method-detail method-alias">
          <a name="method-i-set_pending_connect_timeout"></a>

          
          <div class="method-heading">
            <span class="method-name">set_pending_connect_timeout</span><span
              class="method-args">(value)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
          </div>

          

          
          <div class="aliases">
            Alias for: <a href="Connection.html#method-i-pending_connect_timeout-3D">pending_connect_timeout=</a>
          </div>
          
        </div><!-- set_pending_connect_timeout-method -->

      
        <div id="set_sock_opt-method" class="method-detail ">
          <a name="method-i-set_sock_opt"></a>

          
          <div class="method-heading">
            <span class="method-name">set_sock_opt</span><span
              class="method-args">(level, optname, optval)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="set_sock_opt-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 279</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_sock_opt</span> <span class="ruby-identifier">level</span>, <span class="ruby-identifier">optname</span>, <span class="ruby-identifier">optval</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">set_sock_opt</span> <span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">level</span>, <span class="ruby-identifier">optname</span>, <span class="ruby-identifier">optval</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- set_sock_opt-source -->
            
          </div>

          

          
        </div><!-- set_sock_opt-method -->

      
        <div id="ssl_handshake_completed-method" class="method-detail ">
          <a name="method-i-ssl_handshake_completed"></a>

          
          <div class="method-heading">
            <span class="method-name">ssl_handshake_completed</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Called by <a href="../EventMachine.html">EventMachine</a> when the SSL/TLS
handshake has been completed, as a result of calling <a
href="Connection.html#method-i-start_tls">start_tls</a> to initiate SSL/TLS
on the connection.</p>

<p>This callback exists because {<a
href="Connection.html#method-i-post_init">post_init</a>} and {<a
href="Connection.html#method-i-connection_completed">connection_completed</a>}
are *<b>not</b>* reliable for indicating when an SSL/TLS connection is
ready to have its certificate queried for.</p>

<p>@see <a href="Connection.html#method-i-get_peer_cert">get_peer_cert</a></p>
            

            
            <div class="method-source-code" id="ssl_handshake_completed-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_handshake_completed</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- ssl_handshake_completed-source -->
            
          </div>

          

          
        </div><!-- ssl_handshake_completed-method -->

      
        <div id="ssl_verify_peer-method" class="method-detail ">
          <a name="method-i-ssl_verify_peer"></a>

          
          <div class="method-heading">
            <span class="method-name">ssl_verify_peer</span><span
              class="method-args">(cert)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Called by <a href="../EventMachine.html">EventMachine</a> when :verify_peer
=&gt; true has been passed to {<a
href="Connection.html#method-i-start_tls">start_tls</a>}. It will be called
with each certificate in the certificate chain provided by the remote peer.</p>

<p>The cert will be passed as a String in PEM format, the same as in {<a
href="Connection.html#method-i-get_peer_cert">get_peer_cert</a>}. It is up
to user defined code to perform a check on the certificates. The return
value from this callback is used to accept or deny the peer. A return value
that is not nil or false triggers acceptance. If the peer is not accepted,
the connection will be subsequently closed.</p>

<p>@example This server always accepts all peers</p>

<pre>module AcceptServer
  def post_init
    start_tls(:verify_peer =&gt; true)
  end

  def ssl_verify_peer(cert)
    true
  end

  def ssl_handshake_completed
    $server_handshake_completed = true
  end
end</pre>

<p>@example This server never accepts any peers</p>

<pre>module DenyServer
  def post_init
    start_tls(:verify_peer =&gt; true)
  end

  def ssl_verify_peer(cert)
    # Do not accept the peer. This should now cause the connection to shut down
    # without the SSL handshake being completed.
    false
  end

  def ssl_handshake_completed
    $server_handshake_completed = true
  end
end</pre>

<p>@see <a href="Connection.html#method-i-start_tls">start_tls</a></p>
            

            
            <div class="method-source-code" id="ssl_verify_peer-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 174</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_verify_peer</span>(<span class="ruby-identifier">cert</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- ssl_verify_peer-source -->
            
          </div>

          

          
        </div><!-- ssl_verify_peer-method -->

      
        <div id="start_tls-method" class="method-detail ">
          <a name="method-i-start_tls"></a>

          
          <div class="method-heading">
            <span class="method-name">start_tls</span><span
              class="method-args">(args={})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Call {<a href="Connection.html#method-i-start_tls">start_tls</a>} at any
point to initiate TLS encryption on connected streams. The method is smart
enough to know whether it should perform a server-side or a client-side
handshake. An appropriate place to call {<a
href="Connection.html#method-i-start_tls">start_tls</a>} is in your
redefined {<a href="Connection.html#method-i-post_init">post_init</a>}
method, or in the {<a
href="Connection.html#method-i-connection_completed">connection_completed</a>}
handler for an outbound connection.</p>

<p>@option args [String] :cert_chain_file (nil) local path of a readable file
that contants  a chain of X509 certificates in</p>

<pre>the [PEM format](http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail),
with the most-resolved certificate at the top of the file, successive intermediate
certs in the middle, and the root (or CA) cert at the bottom.</pre>

<p>@option args [String] :private_key_file (nil) local path of a readable file
that must contain a private key in the [PEM format](<a
href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">en.wikipedia.org/wiki/Privacy_Enhanced_Mail</a>).</p>

<p>@option args [Boolean] :verify_peer (false)   indicates whether a server
should request a certificate from a peer, to be verified by user code.</p>

<pre>If true, the {#ssl_verify_peer} callback on the {EventMachine::Connection} object is called with each certificate
in the certificate chain provided by the peer. See documentation on {#ssl_verify_peer} for how to use this.</pre>

<p>@option args [Boolean] :fail_if_no_peer_cert (false)   Used in conjunction
with verify_peer. If set the SSL handshake will be terminated if the peer
does not provide a certificate.</p>

<p>@option args [String] :cipher_list
(“ALL:!ADH:!LOW:!EXP:!DES-CBC3-SHA:@STRENGTH”) indicates the available SSL
cipher values. Default value is
“ALL:!ADH:!LOW:!EXP:!DES-CBC3-SHA:@STRENGTH”. Check the format of the
OpenSSL cipher string at <a
href="http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT">www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT</a>.</p>

<p>@option args [String] :ecdh_curve (nil)  The curve for ECDHE ciphers. See
available ciphers with ‘openssl ecparam -list_curves’</p>

<p>@option args [String] :dhparam (nil)  The local path of a file containing
DH parameters for EDH ciphers in [PEM format](<a
href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">en.wikipedia.org/wiki/Privacy_Enhanced_Mail</a>)
See: ‘openssl dhparam’</p>

<p>@option args [Array] :ssl_version (TLSv1 TLSv1_1 TLSv1_2) indicates the
allowed SSL/TLS versions. Possible values are: {SSLv2}, {SSLv3}, {TLSv1},
{TLSv1_1}, {TLSv1_2}.</p>

<p>@example Using TLS with <a href="../EventMachine.html">EventMachine</a></p>

<pre>require 'rubygems'
require 'eventmachine'

module Handler
  def post_init
    start_tls(:private_key_file =&gt; '/tmp/server.key', :cert_chain_file =&gt; '/tmp/server.crt', :verify_peer =&gt; false)
  end
end

 EventMachine.run do
  EventMachine.start_server(&quot;127.0.0.1&quot;, 9999, Handler)
end</pre>

<p>@param [Hash] args</p>

<p>@todo support passing an encryption parameter, which can be string or Proc,
to get a passphrase for encrypted private keys. @todo support passing key
material via raw strings or Procs that return strings instead of just
filenames.</p>

<p>@see <a href="Connection.html#method-i-ssl_verify_peer">ssl_verify_peer</a></p>
            

            
            <div class="method-source-code" id="start_tls-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 417</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start_tls</span> <span class="ruby-identifier">args</span>={}
  <span class="ruby-identifier">priv_key</span>     = <span class="ruby-identifier">args</span>[<span class="ruby-value">:private_key_file</span>]
  <span class="ruby-identifier">cert_chain</span>   = <span class="ruby-identifier">args</span>[<span class="ruby-value">:cert_chain_file</span>]
  <span class="ruby-identifier">verify_peer</span>  = <span class="ruby-identifier">args</span>[<span class="ruby-value">:verify_peer</span>]
  <span class="ruby-identifier">sni_hostname</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">:sni_hostname</span>]
  <span class="ruby-identifier">cipher_list</span>  = <span class="ruby-identifier">args</span>[<span class="ruby-value">:cipher_list</span>]
  <span class="ruby-identifier">ssl_version</span>  = <span class="ruby-identifier">args</span>[<span class="ruby-value">:ssl_version</span>]
  <span class="ruby-identifier">ecdh_curve</span>   = <span class="ruby-identifier">args</span>[<span class="ruby-value">:ecdh_curve</span>]
  <span class="ruby-identifier">dhparam</span>      = <span class="ruby-identifier">args</span>[<span class="ruby-value">:dhparam</span>]
  <span class="ruby-identifier">fail_if_no_peer_cert</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">:fail_if_no_peer_cert</span>]

  [<span class="ruby-identifier">priv_key</span>, <span class="ruby-identifier">cert_chain</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">FileNotFoundException</span>,
    <span class="ruby-node">&quot;Could not find #{file} for start_tls&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">file</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">protocols_bitmask</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ssl_version</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">protocols_bitmask</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">EM_PROTO_TLSv1</span>
    <span class="ruby-identifier">protocols_bitmask</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">EM_PROTO_TLSv1_1</span>
    <span class="ruby-identifier">protocols_bitmask</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">EM_PROTO_TLSv1_2</span>
  <span class="ruby-keyword">else</span>
    [<span class="ruby-identifier">ssl_version</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
      <span class="ruby-keyword">when</span> <span class="ruby-string">'sslv2'</span>
        <span class="ruby-identifier">protocols_bitmask</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">EM_PROTO_SSLv2</span>
      <span class="ruby-keyword">when</span> <span class="ruby-string">'sslv3'</span>
        <span class="ruby-identifier">protocols_bitmask</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">EM_PROTO_SSLv3</span>
      <span class="ruby-keyword">when</span> <span class="ruby-string">'tlsv1'</span>
        <span class="ruby-identifier">protocols_bitmask</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">EM_PROTO_TLSv1</span>
      <span class="ruby-keyword">when</span> <span class="ruby-string">'tlsv1_1'</span>
        <span class="ruby-identifier">protocols_bitmask</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">EM_PROTO_TLSv1_1</span>
      <span class="ruby-keyword">when</span> <span class="ruby-string">'tlsv1_2'</span>
        <span class="ruby-identifier">protocols_bitmask</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">EM_PROTO_TLSv1_2</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">raise</span>(<span class="ruby-node">&quot;Unrecognized SSL/TLS Protocol: #{p}&quot;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">set_tls_parms</span>(<span class="ruby-ivar">@signature</span>, <span class="ruby-identifier">priv_key</span> <span class="ruby-operator">||</span> <span class="ruby-string">''</span>, <span class="ruby-identifier">cert_chain</span> <span class="ruby-operator">||</span> <span class="ruby-string">''</span>, <span class="ruby-identifier">verify_peer</span>, <span class="ruby-identifier">fail_if_no_peer_cert</span>, <span class="ruby-identifier">sni_hostname</span> <span class="ruby-operator">||</span> <span class="ruby-string">''</span>, <span class="ruby-identifier">cipher_list</span> <span class="ruby-operator">||</span> <span class="ruby-string">''</span>, <span class="ruby-identifier">ecdh_curve</span> <span class="ruby-operator">||</span> <span class="ruby-string">''</span>, <span class="ruby-identifier">dhparam</span> <span class="ruby-operator">||</span> <span class="ruby-string">''</span>, <span class="ruby-identifier">protocols_bitmask</span>)
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">start_tls</span> <span class="ruby-ivar">@signature</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- start_tls-source -->
            
          </div>

          

          
        </div><!-- start_tls-method -->

      
        <div id="stop_proxying-method" class="method-detail ">
          <a name="method-i-stop_proxying"></a>

          
          <div class="method-heading">
            <span class="method-name">stop_proxying</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>A helper method for {<a
href="../EventMachine.html#method-c-disable_proxy">EventMachine.disable_proxy</a>}</p>
            

            
            <div class="method-source-code" id="stop_proxying-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 237</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">stop_proxying</span>
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-identifier">disable_proxy</span>(<span class="ruby-keyword">self</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- stop_proxying-source -->
            
          </div>

          

          
        </div><!-- stop_proxying-method -->

      
        <div id="stream_file_data-method" class="method-detail ">
          <a name="method-i-stream_file_data"></a>

          
          <div class="method-heading">
            <span class="method-name">stream_file_data</span><span
              class="method-args">(filename, args={})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Open a file on the filesystem and send it to the remote peer. This returns
an object of type {EventMachine::Deferrable}. The object’s callbacks will
be executed on the reactor main thread when the file has been completely
scheduled for transmission to the remote peer. Its errbacks will be called
in case of an error (such as file-not-found). This method employs various
strategies to achieve the fastest possible performance, balanced against
minimum consumption of memory.</p>

<p>Warning: this feature has an implicit dependency on an outboard extension,
evma_fastfilereader. You must install this extension in order to use {<a
href="Connection.html#method-i-stream_file_data">stream_file_data</a>} with
files larger than a certain size (currently 8192 bytes).</p>

<p>@option args [Boolean] :http_chunks (false) If true, this method will
stream the file data in a format</p>

<pre>compatible with the HTTP chunked-transfer encoding</pre>

<p>@param [String] filename Local path of the file to stream @param [Hash]
args Options</p>

<p>@return [EventMachine::Deferrable]</p>
            

            
            <div class="method-source-code" id="stream_file_data-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 721</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">stream_file_data</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">args</span>={}
  <span class="ruby-constant">EventMachine</span><span class="ruby-operator">::</span><span class="ruby-constant">FileStreamer</span>.<span class="ruby-identifier">new</span>( <span class="ruby-keyword">self</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">args</span> )
<span class="ruby-keyword">end</span></pre>
            </div><!-- stream_file_data-source -->
            
          </div>

          

          
        </div><!-- stream_file_data-method -->

      
        <div id="unbind-method" class="method-detail ">
          <a name="method-i-unbind"></a>

          
          <div class="method-heading">
            <span class="method-name">unbind</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>called by the framework whenever a connection (either a server or client
connection) is closed. The close can occur because your code intentionally
closes it (using {<a
href="Connection.html#method-i-close_connection">close_connection</a>} and
{<a
href="Connection.html#method-i-close_connection_after_writing">close_connection_after_writing</a>}),
because the remote peer closed the connection, or because of a network
error. You may not assume that the network connection is still open and
able to send or receive data when the callback to unbind is made. This is
intended only to give you a chance to clean up associations your code may
have made to the connection object while it was open.</p>

<p>If you want to detect which peer has closed the connection, you can
override {<a
href="Connection.html#method-i-close_connection">close_connection</a>} in
your protocol handler and set an @ivar.</p>

<p>@example Overriding <a
href="Connection.html#method-i-close_connection">Connection#close_connection</a>
to distinguish connections closed on our side</p>

<pre>class MyProtocolHandler &lt; EventMachine::Connection

  # ...

  def close_connection(*args)
    @intentionally_closed_connection = true
    super(*args)
  end

  def unbind
    if @intentionally_closed_connection
      # ...
    end
  end

  # ...

end</pre>

<p>@see <a href="Connection.html#method-i-post_init">post_init</a> @see <a
href="Connection.html#method-i-connection_completed">connection_completed</a>
@see file:<a
href="../docs/GettingStarted_md.html">docs/GettingStarted.md</a> <a
href="../EventMachine.html">EventMachine</a> tutorial</p>
            

            
            <div class="method-source-code" id="unbind-source">
<pre>
<span class="ruby-comment"># File lib/em/connection.rb, line 212</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unbind</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- unbind-source -->
            
          </div>

          

          
        </div><!-- unbind-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

