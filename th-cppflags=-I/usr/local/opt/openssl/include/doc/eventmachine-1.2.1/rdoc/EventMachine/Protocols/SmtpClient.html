<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: EventMachine::Protocols::SmtpClient</title>

  <link rel="stylesheet" href="../../rdoc.css" type="text/css" media="screen" />

  <script src="../../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../../index.html">Home</a>
          <a href="../../index.html#classes">Classes</a>
          <a href="../../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../../lib/em/protocols/smtpclient_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/em/protocols/smtpclient.rb">lib/em/protocols/smtpclient.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="../Connection.html">EventMachine::Connection</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-c-send">::send</a></li>
          
          <li><a href="#method-i-connection_completed">#connection_completed</a></li>
          
          <li><a href="#method-i-post_init">#post_init</a></li>
          
          <li><a href="#method-i-receive_line">#receive_line</a></li>
          
          <li><a href="#method-i-unbind">#unbind</a></li>
          
        </ul>
      </div>
      

      
      <!-- Included Modules -->
      <div id="includes-section" class="section">
        <h3 class="section-header">Included Modules</h3>
        <ul class="link-list">
        
        
          <li><a class="include" href="../Deferrable.html">EventMachine::Deferrable</a></li>
        
        
        
          <li><a class="include" href="LineText2.html">EventMachine::Protocols::LineText2</a></li>
        
        
        </ul>
      </div>
      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../../docs/old/ChangeLog.html">ChangeLog</a></li>
        
          <li class="file"><a href="../../docs/old/DEFERRABLES.html">DEFERRABLES</a></li>
        
          <li class="file"><a href="../../docs/old/EPOLL.html">EPOLL</a></li>
        
          <li class="file"><a href="../../docs/old/INSTALL.html">INSTALL</a></li>
        
          <li class="file"><a href="../../docs/old/KEYBOARD.html">KEYBOARD</a></li>
        
          <li class="file"><a href="../../docs/old/LEGAL.html">LEGAL</a></li>
        
          <li class="file"><a href="../../docs/old/LIGHTWEIGHT_CONCURRENCY.html">LIGHTWEIGHT_CONCURRENCY</a></li>
        
          <li class="file"><a href="../../docs/old/PURE_RUBY.html">PURE_RUBY</a></li>
        
          <li class="file"><a href="../../docs/old/RELEASE_NOTES.html">RELEASE_NOTES</a></li>
        
          <li class="file"><a href="../../docs/old/SMTP.html">SMTP</a></li>
        
          <li class="file"><a href="../../docs/old/SPAWNED_PROCESSES.html">SPAWNED_PROCESSES</a></li>
        
          <li class="file"><a href="../../docs/old/TODO.html">TODO</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../../EventMachine.html">EventMachine</a></li>
        
          <li><a href="../../EventMachine.html">EventMachine</a></li>
        
          <li><a href="../../EventMachine/CertificateCreator.html">EventMachine::CertificateCreator</a></li>
        
          <li><a href="../../EventMachine/Channel.html">EventMachine::Channel</a></li>
        
          <li><a href="../../EventMachine/Completion.html">EventMachine::Completion</a></li>
        
          <li><a href="../../EventMachine/Connection.html">EventMachine::Connection</a></li>
        
          <li><a href="../../EventMachine/ConnectionError.html">EventMachine::ConnectionError</a></li>
        
          <li><a href="../../EventMachine/ConnectionNotBound.html">EventMachine::ConnectionNotBound</a></li>
        
          <li><a href="../../EventMachine/DNS.html">EventMachine::DNS</a></li>
        
          <li><a href="../../EventMachine/DNS/Request.html">EventMachine::DNS::Request</a></li>
        
          <li><a href="../../EventMachine/DNS/RequestIdAlreadyUsed.html">EventMachine::DNS::RequestIdAlreadyUsed</a></li>
        
          <li><a href="../../EventMachine/DNS/Resolver.html">EventMachine::DNS::Resolver</a></li>
        
          <li><a href="../../EventMachine/DNS/Socket.html">EventMachine::DNS::Socket</a></li>
        
          <li><a href="../../EventMachine/DatagramObject.html">EventMachine::DatagramObject</a></li>
        
          <li><a href="../../EventMachine/DefaultDeferrable.html">EventMachine::DefaultDeferrable</a></li>
        
          <li><a href="../../EventMachine/Deferrable.html">EventMachine::Deferrable</a></li>
        
          <li><a href="../../EventMachine/DeferrableChildProcess.html">EventMachine::DeferrableChildProcess</a></li>
        
          <li><a href="../../EventMachine/Error.html">EventMachine::Error</a></li>
        
          <li><a href="../../EventMachine/EvmaKeyboard.html">EventMachine::EvmaKeyboard</a></li>
        
          <li><a href="../../EventMachine/EvmaTCPClient.html">EventMachine::EvmaTCPClient</a></li>
        
          <li><a href="../../EventMachine/EvmaTCPServer.html">EventMachine::EvmaTCPServer</a></li>
        
          <li><a href="../../EventMachine/EvmaUDPSocket.html">EventMachine::EvmaUDPSocket</a></li>
        
          <li><a href="../../EventMachine/EvmaUNIXClient.html">EventMachine::EvmaUNIXClient</a></li>
        
          <li><a href="../../EventMachine/EvmaUNIXServer.html">EventMachine::EvmaUNIXServer</a></li>
        
          <li><a href="../../EventMachine/FileNotFoundException.html">EventMachine::FileNotFoundException</a></li>
        
          <li><a href="../../EventMachine/FileStreamer.html">EventMachine::FileStreamer</a></li>
        
          <li><a href="../../EventMachine/FileWatch.html">EventMachine::FileWatch</a></li>
        
          <li><a href="../../EventMachine/Iterator.html">EventMachine::Iterator</a></li>
        
          <li><a href="../../EventMachine/LoopbreakReader.html">EventMachine::LoopbreakReader</a></li>
        
          <li><a href="../../EventMachine/PeriodicTimer.html">EventMachine::PeriodicTimer</a></li>
        
          <li><a href="../../EventMachine/Pool.html">EventMachine::Pool</a></li>
        
          <li><a href="../../EventMachine/ProcessWatch.html">EventMachine::ProcessWatch</a></li>
        
          <li><a href="../../EventMachine/Protocols.html">EventMachine::Protocols</a></li>
        
          <li><a href="../../EventMachine/Protocols.html">EventMachine::Protocols</a></li>
        
          <li><a href="../../EventMachine/Protocols/HeaderAndContentProtocol.html">EventMachine::Protocols::HeaderAndContentProtocol</a></li>
        
          <li><a href="../../EventMachine/Protocols/HttpClient.html">EventMachine::Protocols::HttpClient</a></li>
        
          <li><a href="../../EventMachine/Protocols/HttpClient2.html">EventMachine::Protocols::HttpClient2</a></li>
        
          <li><a href="../../EventMachine/Protocols/HttpClient2/Request.html">EventMachine::Protocols::HttpClient2::Request</a></li>
        
          <li><a href="../../EventMachine/Protocols/LineAndTextProtocol.html">EventMachine::Protocols::LineAndTextProtocol</a></li>
        
          <li><a href="../../EventMachine/Protocols/LineProtocol.html">EventMachine::Protocols::LineProtocol</a></li>
        
          <li><a href="../../EventMachine/Protocols/LineText2.html">EventMachine::Protocols::LineText2</a></li>
        
          <li><a href="../../EventMachine/Protocols/Memcache.html">EventMachine::Protocols::Memcache</a></li>
        
          <li><a href="../../EventMachine/Protocols/Memcache/ParserError.html">EventMachine::Protocols::Memcache::ParserError</a></li>
        
          <li><a href="../../EventMachine/Protocols/ObjectProtocol.html">EventMachine::Protocols::ObjectProtocol</a></li>
        
          <li><a href="../../EventMachine/Protocols/Postgres3.html">EventMachine::Protocols::Postgres3</a></li>
        
          <li><a href="../../EventMachine/Protocols/SASLauth.html">EventMachine::Protocols::SASLauth</a></li>
        
          <li><a href="../../EventMachine/Protocols/SASLauthclient.html">EventMachine::Protocols::SASLauthclient</a></li>
        
          <li><a href="../../EventMachine/Protocols/SmtpClient.html">EventMachine::Protocols::SmtpClient</a></li>
        
          <li><a href="../../EventMachine/Protocols/SmtpServer.html">EventMachine::Protocols::SmtpServer</a></li>
        
          <li><a href="../../EventMachine/Protocols/Socks4.html">EventMachine::Protocols::Socks4</a></li>
        
          <li><a href="../../EventMachine/Protocols/Stomp.html">EventMachine::Protocols::Stomp</a></li>
        
          <li><a href="../../EventMachine/Protocols/Stomp/Message.html">EventMachine::Protocols::Stomp::Message</a></li>
        
          <li><a href="../../EventMachine/Protocols/TcpConnectTester.html">EventMachine::Protocols::TcpConnectTester</a></li>
        
          <li><a href="../../EventMachine/Queue.html">EventMachine::Queue</a></li>
        
          <li><a href="../../EventMachine/Reactor.html">EventMachine::Reactor</a></li>
        
          <li><a href="../../EventMachine/Selectable.html">EventMachine::Selectable</a></li>
        
          <li><a href="../../EventMachine/SpawnedProcess.html">EventMachine::SpawnedProcess</a></li>
        
          <li><a href="../../EventMachine/StreamObject.html">EventMachine::StreamObject</a></li>
        
          <li><a href="../../EventMachine/SystemCmd.html">EventMachine::SystemCmd</a></li>
        
          <li><a href="../../EventMachine/ThreadedResource.html">EventMachine::ThreadedResource</a></li>
        
          <li><a href="../../EventMachine/TickLoop.html">EventMachine::TickLoop</a></li>
        
          <li><a href="../../EventMachine/Timer.html">EventMachine::Timer</a></li>
        
          <li><a href="../../EventMachine/UnknownTimerFired.html">EventMachine::UnknownTimerFired</a></li>
        
          <li><a href="../../EventMachine/Unsupported.html">EventMachine::Unsupported</a></li>
        
          <li><a href="../../EventMachine/UuidGenerator.html">EventMachine::UuidGenerator</a></li>
        
          <li><a href="../../EventMachine/YieldBlockFromSpawnedProcess.html">EventMachine::YieldBlockFromSpawnedProcess</a></li>
        
          <li><a href="../../Object.html">Object</a></li>
        
          <li><a href="../../EventMachine.html">Object::EM</a></li>
        
          <li><a href="../../EventMachine/Protocols.html">Object::P</a></li>
        
          <li><a href="../../BufferedTokenizer.html">BufferedTokenizer</a></li>
        
          <li><a href="../../IO.html">IO</a></li>
        
          <li><a href="../../StringIO.html">StringIO</a></li>
        
          <li><a href="../../TestConnection.html">TestConnection</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">EventMachine::Protocols::SmtpClient</h1>

    <div id="description" class="description">
      
<p>Simple SMTP client</p>

<p>@example</p>

<pre>email = EM::Protocols::SmtpClient.send(
  :domain=&gt;&quot;example.com&quot;,
  :host=&gt;'localhost',
  :port=&gt;25, # optional, defaults 25
  :starttls=&gt;true, # use ssl
  :from=&gt;&quot;sender@example.com&quot;,
  :to=&gt; [&quot;to_1@example.com&quot;, &quot;to_2@example.com&quot;],
  :header=&gt; {&quot;Subject&quot; =&gt; &quot;This is a subject line&quot;},
  :body=&gt; &quot;This is the body of the email&quot;
)
email.callback{
  puts 'Email sent!'
}
email.errback{ |e|
  puts 'Email failed!'
}</pre>

<p>Sending generated emails (using Mail)</p>

<pre>mail = Mail.new do
  from    'alice@example.com'
  to      'bob@example.com'
  subject 'This is a test email'
  body    'Hello, world!'
end

email = EM::P::SmtpClient.send(
  :domain=&gt;'example.com',
  :from=&gt;mail.from.first,
  :to=&gt;mail.to,
  :message=&gt;mail.to_s
)</pre>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="args-attribute-method" class="method-detail">
          <a name="args"></a>
          
          <a name="args="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">args</span><span
              class="attribute-access-type">[W]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/em/protocols/smtpclient.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>
  <span class="ruby-ivar">@succeeded</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@responder</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@code</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@msg</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
        <div id="send-method" class="method-detail ">
          <a name="method-c-send"></a>

          
          <div class="method-heading">
            <span class="method-name">send</span><span
              class="method-args">(args={})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>:host =&gt; required String</p>

<pre>a string containing the IP address or host name of the SMTP server to connect to.</pre>

<p>:port =&gt; optional</p>

<pre>defaults to 25.</pre>

<p>:domain =&gt; required String</p>

<pre>This is passed as the argument to the EHLO command.</pre>

<p>:starttls =&gt; optional Boolean</p>

<pre>If it evaluates true, then the client will initiate STARTTLS with
the server, and abort the connection if the negotiation doesn't succeed.
TODO, need to be able to pass certificate parameters with this option.</pre>

<p>:auth =&gt; optional Hash of auth parameters</p>

<pre>If not given, then no auth will be attempted.
(In that case, the connection will be aborted if the server requires auth.)
Specify the hash value :type to determine the auth type, along with additional parameters
depending on the type.
Currently only :type =&gt; :plain is supported. Pass additional parameters :username (String),
and :password (either a String or a Proc that will be called at auth-time).

@example
  :auth =&gt; {:type=&gt;:plain, :username=&gt;&quot;mickey@disney.com&quot;, :password=&gt;&quot;mouse&quot;}</pre>

<p>:from =&gt; required String</p>

<pre>Specifies the sender of the message. Will be passed as the argument
to the MAIL FROM. Do NOT enclose the argument in angle-bracket (&lt;&gt;) characters.
The connection will abort if the server rejects the value.</pre>

<p>:to =&gt; required String or Array of Strings</p>

<pre>The recipient(s) of the message. Do NOT enclose
any of the values in angle-brackets (&lt;&gt;) characters. It's NOT a fatal error if one or more
recipients are rejected by the server. (Of course, if ALL of them are, the server will most
likely trigger an error when we try to send data.) An array of codes containing the status
of each requested recipient is available after the call completes. TODO, we should define
an overridable stub that will be called on rejection of a recipient or a sender, giving
user code the chance to try again or abort the connection.</pre>

<p>One of either :message, :content, or :header and :body is required:</p>

<p>:message =&gt; String</p>

<pre>A valid RFC2822 Internet Message.</pre>

<p>:content =&gt; String</p>

<pre>Raw data which MUST be in correct SMTP body format, with escaped leading dots and a trailing
dot line.</pre>

<p>:header =&gt; String or Hash of values to be transmitted in the header of
the message.</p>

<pre>The hash keys are the names of the headers (do NOT append a trailing colon), and the values
are strings containing the header values. TODO, support Arrays of header values, which would
cause us to send that specific header line more than once.

@example
  :header =&gt; {&quot;Subject&quot; =&gt; &quot;Bogus&quot;, &quot;CC&quot; =&gt; &quot;myboss@example.com&quot;}</pre>

<p>:body =&gt; Optional String or Array of Strings, defaults blank.</p>

<pre>This will be passed as the body of the email message.
TODO, this needs to be significantly beefed up. As currently written, this requires the caller
to properly format the input into CRLF-delimited lines of 7-bit characters in the standard
SMTP transmission format. We need to be able to automatically convert binary data, and add
correct line-breaks to text data.</pre>

<p>:verbose =&gt; Optional.</p>

<pre>If true, will cause a lot of information (including the server-side of the
conversation) to be dumped to $&gt;.</pre>
            

            
            <div class="method-source-code" id="send-source">
<pre>
<span class="ruby-comment"># File lib/em/protocols/smtpclient.rb, line 138</span>
      <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">args</span>={}
        <span class="ruby-identifier">args</span>[<span class="ruby-value">:port</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">25</span>
        <span class="ruby-identifier">args</span>[<span class="ruby-value">:body</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>

<span class="ruby-comment">      (I don't think it's possible for EM#connect to throw an exception under normal
      circumstances, so this original code is stubbed out. A connect-failure will result
      in the #unbind method being called without calling #connection_completed.)
      begin
        EventMachine.connect( args[:host], args[:port], self) {|c|
          # According to the EM docs, we will get here AFTER post_init is called.
          c.args = args
          c.set_comm_inactivity_timeout 60
        }
      rescue
        # We'll get here on a connect error. This code mimics the effect
        # of a call to invoke_internal_error. Would be great to DRY this up.
        # (Actually, it may be that we never get here, if EM#connect catches
        # its errors internally.)
        d = EM::DefaultDeferrable.new
        d.set_deferred_status(:failed, {:error=&gt;[:connect, 500, &quot;unable to connect to server&quot;]})
        d
      end
</span>        <span class="ruby-constant">EventMachine</span>.<span class="ruby-identifier">connect</span>( <span class="ruby-identifier">args</span>[<span class="ruby-value">:host</span>], <span class="ruby-identifier">args</span>[<span class="ruby-value">:port</span>], <span class="ruby-keyword">self</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
          <span class="ruby-comment"># According to the EM docs, we will get here AFTER post_init is called.</span>
          <span class="ruby-identifier">c</span>.<span class="ruby-identifier">args</span> = <span class="ruby-identifier">args</span>
          <span class="ruby-identifier">c</span>.<span class="ruby-identifier">set_comm_inactivity_timeout</span> <span class="ruby-value">60</span>
        }
      <span class="ruby-keyword">end</span></pre>
            </div><!-- send-source -->
            
          </div>

          

          
        </div><!-- send-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="connection_completed-method" class="method-detail ">
          <a name="method-i-connection_completed"></a>

          
          <div class="method-heading">
            <span class="method-name">connection_completed</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>@private</p>
            

            
            <div class="method-source-code" id="connection_completed-source">
<pre>
<span class="ruby-comment"># File lib/em/protocols/smtpclient.rb, line 178</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">connection_completed</span>
  <span class="ruby-ivar">@responder</span> = <span class="ruby-value">:receive_signon</span>
  <span class="ruby-ivar">@msg</span> = []
<span class="ruby-keyword">end</span></pre>
            </div><!-- connection_completed-source -->
            
          </div>

          

          
        </div><!-- connection_completed-method -->

      
        <div id="post_init-method" class="method-detail ">
          <a name="method-i-post_init"></a>

          
          <div class="method-heading">
            <span class="method-name">post_init</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>@private</p>
            

            
            <div class="method-source-code" id="post_init-source">
<pre>
<span class="ruby-comment"># File lib/em/protocols/smtpclient.rb, line 172</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post_init</span>
  <span class="ruby-ivar">@return_values</span> = <span class="ruby-constant">OpenStruct</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@return_values</span>.<span class="ruby-identifier">start_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- post_init-source -->
            
          </div>

          

          
        </div><!-- post_init-method -->

      
        <div id="receive_line-method" class="method-detail ">
          <a name="method-i-receive_line"></a>

          
          <div class="method-heading">
            <span class="method-name">receive_line</span><span
              class="method-args">(ln)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>@private</p>
            

            
            <div class="method-source-code" id="receive_line-source">
<pre>
<span class="ruby-comment"># File lib/em/protocols/smtpclient.rb, line 200</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">receive_line</span> <span class="ruby-identifier">ln</span>
  <span class="ruby-identifier">$&gt;</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">ln</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@args</span>[<span class="ruby-value">:verbose</span>]
  <span class="ruby-ivar">@range</span> = <span class="ruby-identifier">ln</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
  <span class="ruby-ivar">@code</span> = <span class="ruby-identifier">ln</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">3</span>].<span class="ruby-identifier">to_i</span>
  <span class="ruby-ivar">@msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ln</span>[<span class="ruby-value">4</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ln</span>[<span class="ruby-value">3</span><span class="ruby-operator">...</span><span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'-'</span>
    <span class="ruby-identifier">$&gt;</span>.<span class="ruby-identifier">puts</span> <span class="ruby-ivar">@responder</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@args</span>[<span class="ruby-value">:verbose</span>]
    <span class="ruby-identifier">send</span> <span class="ruby-ivar">@responder</span>
    <span class="ruby-ivar">@msg</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- receive_line-source -->
            
          </div>

          

          
        </div><!-- receive_line-method -->

      
        <div id="unbind-method" class="method-detail ">
          <a name="method-i-unbind"></a>

          
          <div class="method-heading">
            <span class="method-name">unbind</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>We can get here in a variety of ways, all of them being failures unless the
@succeeded flag is set. If a protocol success was recorded, then don’t set
a deferred success because the caller will already have done it (no need to
wait until the connection closes to invoke the callbacks).</p>

<p>@private</p>
            

            
            <div class="method-source-code" id="unbind-source">
<pre>
<span class="ruby-comment"># File lib/em/protocols/smtpclient.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unbind</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@succeeded</span>
    <span class="ruby-ivar">@return_values</span>.<span class="ruby-identifier">elapsed_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@return_values</span>.<span class="ruby-identifier">start_time</span>
    <span class="ruby-ivar">@return_values</span>.<span class="ruby-identifier">responder</span> = <span class="ruby-ivar">@responder</span>
    <span class="ruby-ivar">@return_values</span>.<span class="ruby-identifier">code</span> = <span class="ruby-ivar">@code</span>
    <span class="ruby-ivar">@return_values</span>.<span class="ruby-identifier">message</span> = <span class="ruby-ivar">@msg</span>
    <span class="ruby-identifier">set_deferred_status</span>(<span class="ruby-value">:failed</span>, <span class="ruby-ivar">@return_values</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- unbind-source -->
            
          </div>

          

          
        </div><!-- unbind-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

